<!DOCTYPE html>
<html>
    <head>

        <script type="text/javascript">
            var microlang_test_number;
            var microlang_test_count;
            var microlang_tests = [];

            var input;
            var output;
            var code;
            var error;
        </script>

        <script type="text/javascript" src="../../microlang.js"></script>
        <script type="text/javascript" src="assets/jquery.js"></script>
        <script type="text/javascript" src="autogenerated/tests.js"></script>
        <script type="text/javascript">



            $( document ).ready( test_worker );



            function test_worker()
            {
                var success;

                success = microlang_tests[ microlang_test_number ]();

                if( ! success ) return;

                microlang_test_number++;
                if( microlang_test_number > microlang_test_count )
                {
                    $('#textbox').text("All tests passed!");
                    return;
                }

                setTimeout( test_worker, 50 );
            }



            function execute()
            {
                var io;

                $('#textbox').text( "Running test " + microlang_test_number + ":" + microlang_test_count )

                io = {};

                for( key in input )
                {
                    if( input.hasOwnProperty( key ) )
                    {
                        io[key] = input[key];
                    }
                }

                error = microlang( code, io );

                output = {};

                for( key in io )
                {
                    if( io.hasOwnProperty( key ) )
                    {
                        output[key] = io[key];
                    }
                }
            }



            function assert( assertion, assertion_str )
            {
                var result,
                    input_str,
                    output_str;

                if( typeof( assertion ) === 'undefined' )
                {
                    assertion = null;
                    assertion_str = 'an error must occurr';
                }

                if( assertion === true && error === '' )
                {
                    return true;
                }

                if( assertion === false && error === '')
                {
                    result = "test " + microlang_test_number + ":" + microlang_test_count + " failed: assertion is not true";
                }

                if( assertion === null && error === '')
                {
                    result =  "test " + microlang_test_number + ":" + microlang_test_count + " failed: an error has NOT occurred";
                }

                if( assertion === true && error !== '')
                {
                    result =  "test " + microlang_test_number + ":" + microlang_test_count + " FAILED WITH MICROLANG ERROR";
                }

                if( assertion === false && error !== '')
                {
                    result =  "test " + microlang_test_number + ":" + microlang_test_count + " FAILED WITH MICROLANG ERROR";
                }

                if( assertion === null && error !== '')
                {
                    return true;
                }

                input_str  = to_string( input );
                output_str = to_string( output );

                result += "\n\nCode:\n" + number_code( code ) + "\n\n";
                result += "Error: \"" + error + "\"\n\n";
                result += "Input:\n" + input_str + "\n\n";
                result += "Output:\n" + output_str + "\n\n";
                result += "Assertion: " + assertion_str + "\n\n";

                result = string_escape( result );

                $('#textbox').html( result );

                return false;
            }


            function number_code( txt )
            {
                var i,n,c,o;

                while( true )
                {
                    if( txt === '' ) break;

                    c = txt.charAt( 0 );
                    if( c === '\n' || c === ' ' )
                    {
                        txt = txt.substring( 1 );
                    }
                    else
                    {
                        break;
                    }
                }

                while( true )
                {
                    if( txt === '' ) break;

                    n = txt.length;

                    c = txt.charAt( n - 1 );

                    if( c === '\n' || c === ' ' )
                    {
                        txt = txt.substring( n - 1, n );
                    }
                    else
                    {
                        break;
                    }
                }

                txt = txt.split( "\n" );

                o = '';

                n = txt.length;

                for( i = 1; i <= n; i++ )
                {
                    if( o !== '' ) o += "\n";
                    o += '[ ';
                    if( i < 10 ) o += ' ';
                    o += i + ' ] ' + txt[ i - 1 ];
                }

                return o;
            }



            function to_string( obj )
            {
                var str, key, value;

                str = "";

                for( key in obj )
                {
                    if( str !== "" ) str += "\n";

                    if( obj.hasOwnProperty( key ) )
                    {
                        value = obj[key];

                        if( typeof( value ) === 'string' )
                        {
                            value = "\"" + value + "\"";
                        }

                        str = str + key + " = " + value;
                    }
                }

                if( str === '' )
                {
                    str = "(no data)";
                }

                return str;
            }



            function string_escape( s )
            {
                var c,
                    h,
                    n,
                    i,
                    b;

                n = s.length;
                h = '';
                b = false;

                for( i = 0; i < n; i++ )
                {
                    c = s.charCodeAt( i );

                    if( c == 32 && b )
                    {
                        h += '&nbsp;';
                    }
                    else if( c == 32 && ! b )
                    {
                        h += ' ';
                        b = true;
                        continue;
                    }
                    else if( c == 10 )
                    {
                        h += '<br />';
                    }
                    else if( c == 60 || c == 62 )
                    {
                        h += '&#' + c + ';';
                    }
                    else
                    {
                        h += String.fromCharCode( c );
                    }

                    b = false;
                }

                return h;
            }



        </script>
        <link rel="stylesheet" type="text/css" href="assets/testsuite.css">

        <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="assets/favicon/site.webmanifest">
        <link rel="mask-icon" href="assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
    </head>
    <body>
        <div id="textbox">
        </div>
    </body>
</html>
